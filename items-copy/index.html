<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">

<!-- Font Awesome（最新版） -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

<link rel="stylesheet" href="https://unpkg.com/multiple-select@1.5.2/dist/multiple-select.min.css">
<script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
<script src="https://unpkg.com/multiple-select@1.5.2/dist/multiple-select.min.js"></script>

<title>アイテム効果：テキスト検索＆コピー</title>
<link rel="icon" href="/favicon.ico?v=2" type="image/x-icon">
<link id="switchable-style" rel="stylesheet" href="style_a.css">
<link rel="stylesheet" href="darkmode.css">
</head>
<body>

<div class="header-container">
  <a href="../" class="top-button">戻る</a>
  <h1>アイテム効果：テキスト検索＆コピー</h1>

  <!-- ダークモードスイッチ -->
  <label class="toggle-button-1">
    <input type="checkbox" id="darkModeToggle" />
    <span class="icon"></span>
  </label>

  <p>
    参照範囲：IA<br>
    使い方：<a href="https://www.notion.so/25dc38a4a4108006875dc85608214762?source=copy_link" target="_blank">気が早いwiki≫配布ページ</a>を参考にしてください
  </p>

<pre id="code-to-copy" style="display:none;">
javascript:(async function(){const text=await navigator.clipboard.readText();if(!text.trim()){alert("クリップボードにデータがありません。");return;}const addedItems=[];const cfgs={"武器":{addFunc:window.addWeapon,prefix:"weapon",map:{名称:"Name",常備化:"Stock",経験点:"Exp",種別:"Type",技能:"Skill",命中:"Acc",攻撃力:"Atk",ガード値:"Guard",射程:"Range",効果:"Note"}},"防具":{addFunc:window.addArmor,prefix:"armor",map:{名称:"Name",常備化:"Stock",経験点:"Exp",種別:"Type",行動:"Initiative",ドッジ:"Dodge",装甲値:"Armor",効果:"Note"}},"ヴィークル":{addFunc:window.addVehicle,prefix:"vehicle",map:{名称:"Name",常備化:"Stock",経験点:"Exp",種別:"Type",技能:"Skill",行動:"Initiative",攻撃力:"Atk",装甲値:"Armor",全力移動:"Dash",効果:"Note"}},"一般":{addFunc:window.addItem,prefix:"item",map:{名称:"Name",常備化:"Stock",経験点:"Exp",種別:"Type",技能:"Skill",効果:"Note"}}};const regex=/\[(武器|防具|ヴィークル|一般)\]([\s\S]*?)(?=\[(?:武器|防具|ヴィークル|一般)\]|$)/g;let m;while((m=regex.exec(text))!==null){const type=m[1].trim();const body=m[2].trim();const cfg=cfgs[type];if(!cfg){console.warn("カテゴリ不明:",type);continue;}if(typeof cfg.addFunc==="function")cfg.addFunc();await new Promise(r=>setTimeout(r,100));const tb=document.querySelector(`#${cfg.prefix}-row1%60).closest("tbody");const rows=tb.querySelectorAll("tr");const row=rows[rows.length-1];if(!row){console.warn(%60${type}の新しい行が見つかりません。%60);continue;}const nameMatch=body.match(/名称[:：]([^\s｜]+)/);if(nameMatch)addedItems.push(nameMatch[1].trim());Object.entries(cfg.map).forEach(([jp,en])=>{if(jp!=="効果"){const re=new RegExp(%60${jp}[:：]\\s*([^｜\\s]+|―)%60);const match=body.match(re);if(match){const input=row.querySelector(%60[name*='${cfg.prefix}'][name*='${en}']%60);if(input)input.value=match[1].trim();}}});const eff=body.match(/効果[:：]([^｜]+)(｜[\s\S]*)?/);if(eff){const input=row.querySelector(%60[name*='${cfg.prefix}'][name*='Note']%60);if(input)input.value=(eff[1]+(eff[2]||"")).trim();}}if(addedItems.length>0){alert(%60${addedItems.join("、")} を追加しました！%60);}else{alert("ごめんなさい！追加できなかった。");}})();
</pre>

<button id="button-book">ブックマークレットをコピー</button>


 <p>👆と合わせて使ってね</p>

  <!-- 切替ボタン -->
  <div class="button-group">
    <button class="button-36" data-target="weapon">武器</button>
    <button class="button-36" data-target="armor">防具</button>
    <button class="button-36" data-target="vehicle">ヴィークル</button>
    <button class="button-36" data-target="common">一般アイテム</button>
    <button class="button-36" data-target="conne">コネ</button>
    <button class="button-36" data-target="custom">カスタマイズ</button>
  </div>

  <!-- 検索窓 -->
  <div id="search-container"></div>

  <!-- フィルター -->
  <div id="detailedFilters" class="hidden"></div>

  <!-- アイテム表示用 -->
  <div id="copy-container"></div>
</div>

<!-- スクリプト読み込み -->
<script src="darkmode.js" defer></script>
<script src="main.js" defer></script>

</body>
</html>
